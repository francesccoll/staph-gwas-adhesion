#!/bin/sh

set -e

# This bash script gets the portion of the reference whole-genome alignment that corresponds to the core-genome.

align1="/User/53.marta_zapotoczna_IE/mapping/mzIE_samples.v2.mfa";
align1="/User/53.marta_zapotoczna_IE/mapping/mzIE_samples.v3.mfa";

align2="/User/53.marta_zapotoczna_IE/mapping/mzIE_samples.v2.core.mfa";
align2="/User/53.marta_zapotoczna_IE/mapping/mzIE_samples.v3.core.mfa";

dir2="/User/11.snp_cut-off/core_genome/richardson2018/roary/";

core_genome_bed=$dir2"ST30_strain_MRSA252.BX571856.richardson2018_core_genome.one_copy.bed";

core_genome_tab=$dir2"ST30_strain_MRSA252.BX571856.richardson2018_core_genome.one_copy.tab";

seqkit stats $align1
# file                 format  type  num_seqs        sum_len    min_len    avg_len    max_len
# mzIE_samples.v2.mfa  FASTA   DNA        550  1,596,440,450  2,902,619  2,902,619  2,902,619
# mzIE_samples.v3.mfa  FASTA   DNA        560  1,625,466,640  2,902,619  2,902,619  2,902,619


python2.7 ~/bin/remove_blocks_from_aln.py -a $align1 -o $align2 -t $core_genome_tab -k
# Found 1766 regions
# Adjusted 550 sequences
# Original alignment length: 2902619	New alignment length:1755981
# Done.

seqkit stats $align2
# file                      format  type  num_seqs      sum_len    min_len    avg_len    max_len
# mzIE_samples.v2.core.mfa  FASTA   DNA        550  965,789,550  1,755,981  1,755,981  1,755,981
# mzIE_samples.v3.core.mfa  FASTA   DNA        560  983,349,360  1,755,981  1,755,981  1,755,981

